%h2 Shares

- if @tasks.present?
  %h3 Notifications
  .section
    %ul.tasks
      - @tasks.each do |task|
        = content_tag_for(:li, task) do
          = render :partial => 'tasks/task', :locals => {:task => task}

.section
  %p
    You currently hold:
    = pluralize(current_user.shares_count, "share")
    in
    = co.name + '.'
  %p
    The share value is
    = number_to_currency(co.share_value_in_pounds, :unit => "Â£")
  %p
    The minimum shareholding is
    = pluralize(co.minimum_shareholding, "share.", "shares.")
  - if co.interest_rate
    %p
      The rate of interest on share capital is
      = "#{co.interest_rate}%."

.section
  - if can?(:create, ShareApplication)
    = link_button("Apply for more shares", :url => new_share_application_path)
  %br.clear

- if can?(:read, ShareTransaction)
  - if @share_withdrawals.present?
    .section
      %h3 Outstanding share withdrawals
      %ul.share_withdrawals
        - @share_withdrawals.each do |share_withdrawal|
          = content_tag_for(:li, share_withdrawal) do
            = link_to(share_withdrawal.from_account.owner.name, member_path(share_withdrawal.from_account.owner))
            applied to withdraw
            = pluralize(share_withdrawal.amount, 'share')
            on
            = share_withdrawal.created_at.to_date.to_s(:long) + '.'
            - if share_withdrawal.withdrawal_due?
              The withdrawal is now due.
            - else
              Payment will become due on
              = share_withdrawal.withdrawal_due_date.to_s(:long) + '.'
              = link_button("Waive the notice period", :url => confirm_approve_share_transaction_path(share_withdrawal))

- if can?(:read, ShareAccount)
  .section
    %h3 Share ownership
    %table.share_account_balances
      %thead
        %tr
          %th Member
          %th Shares
      %tbody
        - @members.each do |member|
          = content_tag_for(:tr, member) do
            %td= link_to(member.name, member_path(member))
            %td= member.find_or_build_share_account.balance

- if can?(:update, co)
  .section
    = link_button("Adjust share value", :url => edit_share_value_shares_path)
    = link_button("Adjust minimum shareholding", :url => edit_minimum_shareholding_shares_path)
    = link_button("Adjust interest rate", :url => edit_interest_rate_shares_path)
    %br.clear
